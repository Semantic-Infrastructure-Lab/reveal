# Reveal Roadmap
> **Last updated**: 2026-02-27 (magnetic-regiment-0227 ‚Äî cpanel:// adapter, S3/S4 nginx diagnostics, N1-N4 operator commands)

This document outlines reveal's development priorities and future direction. For contribution opportunities, see [CONTRIBUTING.md](CONTRIBUTING.md).

---

## What We've Shipped

### Unreleased (v0.54.0)
- üîÑ **cpanel:// adapter** ‚Äî first-class cPanel user environment adapter: `reveal cpanel://USERNAME` (overview), `/domains` (all docroots), `/ssl` (disk cert health), `/acl-check` (nobody ACL). All filesystem-based; no WHM API needed.
- üîÑ **nginx: S4 ‚Äî `--cpanel-certs`** ‚Äî disk cert vs live cert comparison per SSL domain; detects "AutoSSL renewed but nginx not reloaded" (`‚ö†Ô∏è STALE (reload nginx)`). Exit 2 on stale or expired.
- üîÑ **nginx: S3 ‚Äî `--diagnose`** ‚Äî scans last 5,000 lines of nginx error log for ACME/SSL failures by domain; groups `permission_denied`, `ssl_error`, `not_found`; exit 2 on first two.
- üîÑ **nginx: N1 ‚Äî `--check-acl`** ‚Äî checks nobody-user has read+execute on every `root` directive; exits 2 on any failure.
- üîÑ **nginx: N4 ‚Äî `--extract acme-roots`** ‚Äî ACME root paths + nobody ACL status table across all SSL domains.
- üîÑ **nginx: N2 ‚Äî `--check-conflicts`** ‚Äî detects prefix overlap and regex-shadows-prefix location routing issues; exit 2 on regex conflicts.
- üîÑ **nginx: N3 ‚Äî `--domain` filter** ‚Äî filter any nginx output to a single domain's server block(s).
- üîÑ **nginx: `--validate-nginx-acme`** ‚Äî composed audit: ACME root path + ACL + live SSL per domain in one table.
- üîÑ **ssl: S2 ‚Äî `ssl://file:///path`** ‚Äî inspect on-disk PEM/DER certs without a network connection.
- üîÑ **ssl: S1 ‚Äî batch failure detail** ‚Äî `--batch --check` shows failure reason inline: EXPIRED, DNS FAILURE (NXDOMAIN), CONNECTION REFUSED, TIMEOUT.
- üîÑ **ssl: S5 ‚Äî expiry dates in batch output** ‚Äî warnings show "expires in N days (Mon DD, YYYY)"; healthy shows "N days (Mon DD, YYYY)".

### v0.53.0
- ‚úÖ **`--check` grouped output** ‚Äî rules firing ‚â• 10√ó per file collapse to summary + "+N more" note; `--no-group` expands all
- ‚úÖ **Auto-generated file skip** ‚Äî `# reveal: generated` (and common patterns like `# Generated by`) skips files in recursive `--check`
- ‚úÖ **nginx: N006 rule** (HIGH) ‚Äî `send_timeout`/`proxy_read_timeout` < 60s + `client_max_body_size` > 10m; caught real Sociamonials incident

### v0.52.0
- ‚úÖ **nginx: main context directives** ‚Äî `user`, `worker_processes`, `worker_rlimit_nofile`, `error_log`, `pid` now visible in `nginx.conf`; `ssl_protocols`, `ssl_ciphers`, `client_max_body_size` visible in vhost includes
- ‚úÖ **nginx: multi-line directives** ‚Äî `log_format` and other continuation-line directives no longer silently dropped
- ‚úÖ **nginx: upstream backend detail** ‚Äî server entries, `max_fails`, `fail_timeout`, `keepalive` now surfaced per upstream
- ‚úÖ **nginx: map{} block detection** ‚Äî `map $src $target {}` blocks detected and listed (cPanel/WHM pattern)
- ‚úÖ **nginx: N005 rule** ‚Äî flags timeout/buffer directives outside safe operational bounds

### v0.51.1
- ‚úÖ **Cross-platform CI** ‚Äî All 6 matrix jobs pass (Python 3.10/3.12 √ó Ubuntu/macOS/Windows)
- ‚úÖ **Claude adapter two-pass search** ‚Äî TIA-style directory names always checked before UUID filename matches
- ‚úÖ **V009 symlink fix** ‚Äî `normpath` instead of `resolve()` prevents macOS `/var` ‚Üí `/private/var` expansion
- ‚úÖ **Windows path separators** ‚Äî `.as_posix()` in V003 and stats adapter; robust drive-letter parsing in diff adapter
- ‚úÖ **Windows encoding** ‚Äî `encoding='utf-8'` in scaffold write/read; `charmap` errors eliminated
- ‚úÖ **DNS dev dep** ‚Äî `dnspython>=2.0.0` added to dev extras so DNS adapter tests load correctly
- ‚úÖ **chmod tests skipped on Windows** ‚Äî V002/V007/V011/V015/validation tests skip where `chmod(0o000)` is a no-op

### v0.51.0
- ‚úÖ **I002 cache fix** ‚Äî Import graph cache keyed on project root (not file parent); 73-subdir project: 13 min ‚Üí 33s
- ‚úÖ **I002 shared graph across workers** ‚Äî Pre-build once in main process, seed workers via pool initializer; CPU cost 4√ó ‚Üí 1√ó
- ‚úÖ **`--check` parallelism** ‚Äî ProcessPoolExecutor (4 workers); 3,500-file project: 48s ‚Üí 21.5s (2.2√ó)
- ‚úÖ **O(n¬≤) scan eliminated** ‚Äî Rule registry short-circuits correctly; large projects: minutes ‚Üí ~30s
- ‚úÖ **Security hardening** ‚Äî Zip bomb protection, 100 MB file guard, MySQL URL parsing fix, frontmatter eval hardening
- ‚úÖ **claude:// content views** ‚Äî `/user`, `/assistant`, `/thinking`, `/message/<n>` render real content
- ‚úÖ **claude:// search** ‚Äî `?search=term` searches all content including thinking blocks and tool inputs
- ‚úÖ **Bug fixes** ‚Äî ast:// OR logic, `--check` recursive mode, M102/I004 false positives, D001 scoping

### v0.50.0
- ‚úÖ **MySQL table I/O statistics** ‚Äî `mysql:///tables` endpoint for table hotspot detection
- ‚úÖ **Automatic alerts** ‚Äî Extreme read ratios (>10K:1), high volume (>1B reads), long-running (>1h)
- ‚úÖ **Token efficiency** ‚Äî 300-500 tokens vs 2000+ for raw SQL queries
- ‚úÖ **Windows CI fixes** ‚Äî 19 of 22 test failures resolved (86% success rate)
- ‚úÖ **UTF-8 encoding** ‚Äî Cross-platform file handling with explicit encoding

### v0.49.2
- ‚úÖ **Windows CI compatibility** ‚Äî 100% test pass rate on Windows (3177/3177 tests)
- ‚úÖ **Path separator normalization** ‚Äî Cross-platform MANIFEST.in validation
- ‚úÖ **Platform-independent test detection** ‚Äî Use Path.parts for Windows compatibility
- ‚úÖ **Permission test handling** ‚Äî Skip chmod-based tests on Windows

### v0.49.1
- ‚úÖ **Help system badges** ‚Äî Mark xlsx, ssl, and domain as üü° Beta (production-ready)

### v0.49.0
- ‚úÖ **xlsx:// adapter** ‚Äî Complete Excel spreadsheet inspection and data extraction
- ‚úÖ **Sheet extraction** ‚Äî By name (case-insensitive) or 0-based index
- ‚úÖ **Cell range extraction** ‚Äî A1 notation support (A1:Z100, supports AA-ZZ columns)
- ‚úÖ **CSV export** ‚Äî `?format=csv` query parameter for data extraction
- ‚úÖ **40 comprehensive tests** ‚Äî 100% passing, performance tested up to 20K+ rows
- ‚úÖ **Complete documentation** ‚Äî Help system, demo docs, examples

### v0.48.0
- ‚úÖ **Phase 3: Query Operator Standardization** ‚Äî Universal query operators (`=`, `!=`, `>`, `<`, `>=`, `<=`, `~=`, `..`) across all adapters
- ‚úÖ **Phase 4: Field Selection** ‚Äî Token reduction with `--fields`, budget constraints (`--max-items`, `--max-bytes`)
- ‚úÖ **Phase 5: Element Discovery** ‚Äî Auto-discovery of available elements in text and JSON output
- ‚úÖ **Phase 8: Convenience Flags** ‚Äî Ergonomic `--search`, `--sort`, `--type` flags for 80% of within-file queries
- ‚úÖ **Result control** ‚Äî `sort`, `limit`, `offset` work consistently across ast://, json://, markdown://, stats://, git://
- ‚úÖ **Progressive disclosure** ‚Äî `available_elements` enables programmatic element discovery

### v0.47.0
- ‚úÖ **Phase 6: Help Introspection** ‚Äî Machine-readable adapter schemas for all 15 adapters
- ‚úÖ **Phase 7: Output Contract v1.1** ‚Äî Trust metadata (parse_mode, confidence, warnings, errors)
- ‚úÖ **help://schemas/<adapter>** ‚Äî JSON schemas for AI agent auto-discovery
- ‚úÖ **help://examples/<task>** ‚Äî Canonical query recipes for common tasks

### v0.45.0
- ‚úÖ **Phase 1: Universal Operation Flags** ‚Äî `--advanced`, `--only-failures` across all adapters
- ‚úÖ **Phase 2: Stdin Batch Processing** ‚Äî Universal `--batch` flag with result aggregation
- ‚úÖ **Batch mode** ‚Äî Works with any adapter, mixed adapter batches supported
- ‚úÖ **Format consistency** ‚Äî All 18 adapters support `--format json|text`

### v0.44.2
- ‚úÖ **SSL certificate parsing fix** ‚Äî TLS 1.3 connections properly handled (cryptography dependency)
- ‚úÖ **52 SSL tests passing** ‚Äî Comprehensive test coverage

### v0.44.1
- ‚úÖ **Batch SSL filter flags** ‚Äî `--only-failures`, `--summary`, `--expiring-within` work with `--stdin --check`
- ‚úÖ **Issue #19 resolved** ‚Äî Composable SSL batch checks fully functional

### v0.44.0
- ‚úÖ **`--extract` flag** ‚Äî Extract structured data for composable pipelines
- ‚úÖ **domain:// adapter** ‚Äî Domain registration, DNS records, health status inspection

### v0.43.0
- ‚úÖ **`@file` batch syntax** ‚Äî Read targets from a file (`reveal @domains.txt --check`)
- ‚úÖ **`ssl://nginx:///` integration** ‚Äî Extract and check SSL domains from nginx configs
- ‚úÖ **Batch SSL filters** ‚Äî `--only-failures`, `--summary`, `--expiring-within N`
- ‚úÖ **Validation rule fixes** ‚Äî V004/V007/V011 skip non-dev installs (no false positives)

### v0.42.0
- ‚úÖ **Universal `--stdin` URI support** ‚Äî Batch processing works with any URI scheme (ssl://, claude://, env://)
- ‚úÖ **Query parsing utilities** ‚Äî New `reveal/utils/query.py` for adapter authors
- ‚úÖ **SSL batch workflows** ‚Äî Check multiple certificates via stdin pipeline
- ‚úÖ **Nginx+SSL integration docs** ‚Äî Comprehensive AGENT_HELP.md coverage

### v0.41.0
- ‚úÖ **`ssl://` adapter** ‚Äî SSL/TLS certificate inspection (zero dependencies)
- ‚úÖ **N004 rule** ‚Äî ACME challenge path inconsistency detection
- ‚úÖ **Content-based nginx detection** ‚Äî `.conf` files detected by content, not path
- ‚úÖ **Enhanced nginx display** ‚Äî Server ports `[443 (SSL)]`, location targets

### v0.40.0
- ‚úÖ **`--dir-limit` flag** ‚Äî Per-directory entry limit (solves node_modules problem)
- ‚úÖ **`--adapters` flag** ‚Äî List all URI adapters with descriptions
- ‚úÖ **M104 rule** ‚Äî Hardcoded list detection for maintainability
- ‚úÖ **ROADMAP.md** ‚Äî Public roadmap for contributors
- ‚úÖ **Breadcrumb improvements** ‚Äî Extraction hints for 25+ file types

### v0.33 - v0.39

#### Language Support
- ‚úÖ **Kotlin, Swift, Dart** ‚Äî Mobile development platforms
- ‚úÖ **Zig** ‚Äî Systems programming
- ‚úÖ **Terraform/HCL** ‚Äî Infrastructure-as-code
- ‚úÖ **GraphQL** ‚Äî API schemas
- ‚úÖ **Protocol Buffers** ‚Äî gRPC serialization
- ‚úÖ **CSV/Excel** ‚Äî Tabular data analysis

#### Adapters
- ‚úÖ **sqlite://** ‚Äî SQLite database inspection
- ‚úÖ **git://** ‚Äî Repository history and blame analysis
- ‚úÖ **imports://** ‚Äî Dependency analysis with circular detection

#### Quality & Developer Experience
- ‚úÖ **Output Contract** ‚Äî Stable, documented output formats
- ‚úÖ **Stability Taxonomy** ‚Äî Clear API stability guarantees
- ‚úÖ **Workflow Recipes** ‚Äî Common usage patterns documented

---

## Current Focus: Path to v1.0

### Test Coverage & Quality
- Overall coverage: 75% (2911 tests passing)
- Database adapter status: MySQL 54%, SQLite 96% ‚úÖ
- Target: 80%+ coverage for core adapters

### UX Consistency (Phases 3-5)
- **Phase 3**: Query operator standardization ‚úÖ **COMPLETE**
  - Universal operators across all 5 query-capable adapters
  - Sort/limit/offset result control unified
  - Documentation: QUERY_SYNTAX_GUIDE.md created
  - Completed: 2026-02-08 (Sessions: hosuki-0208, gentle-cyclone-0208)
- **Phase 4**: Field selection + budget awareness ‚úÖ **COMPLETE**
  - `--fields=field1,field2` for token reduction (5-10x)
  - Budget flags: `--max-items`, `--max-bytes`, `--max-depth`, `--max-snippet-chars`
  - Truncation metadata in output contract
  - Documentation: FIELD_SELECTION_GUIDE.md created (644 lines)
  - Completed: 2026-02-08 (Session: luminous-twilight-0208, ~4 hours)
- **Phase 5**: Element discovery ‚úÖ **COMPLETE**
  - Added `get_available_elements()` to base adapter
  - Text output shows "üìç Available elements" hints with descriptions
  - JSON output includes `available_elements` array for programmatic discovery
  - Implemented in 4 adapters with fixed elements (SSL, Domain, MySQL, Python)
  - 10 adapters with dynamic elements use default empty list
  - Documentation: ELEMENT_DISCOVERY_GUIDE.md created (698 lines)
  - Completed: 2026-02-08 (Session: scarlet-shade-0208, ~4 hours)

### Stability & Polish
- Output contract v1.1 enforcement
- Performance optimization for large codebases

---

## Post-v1.0 Features

> **Status**: Strategic backlog. Not prioritized for implementation yet.
> See `internal-docs/design/SUBCOMMANDS_DESIGN.md` for the full design.

### Subcommands (Intent-Based Workflows)

Reveal's URI model (`reveal <path|uri> [flags]`) is powerful for resource exploration. Subcommands address a complementary need: encoding *user intent* as first-class CLI verbs that orchestrate multiple adapters into unified workflows.

**Design principle**: URIs explore resources. Subcommands accomplish goals.

#### Tier 1 (Highest Value)

**`reveal check`** ‚Äî formalize the existing `--check` flag as a proper subcommand
```bash
reveal check ./src
reveal check ./src --select=B,S --only-failures
```
Low effort, high ergonomics gain. Makes linting discoverable in `reveal --help`.

---

**`reveal review`** ‚Äî code review workflow for PRs and health checks
```bash
reveal review ./src                  # Health + quality review
reveal review main..feature          # PR structural diff + quality
reveal review main..feature --format json  # CI/CD gate (exit codes)
```
Orchestrates: `diff://`, `stats://`, `ast://`, `imports://`, `--check`. Five commands today; one command tomorrow.

---

**`reveal pack`** ‚Äî curated, token-budgeted context for LLM consumption
```bash
reveal pack ./src --budget 2000-tokens
reveal pack ./api --budget 500-lines
```
Formalizes "give me enough context but not too much." Critical for agentic workflows.

---

**`reveal health`** ‚Äî unified health check across any resource type
```bash
reveal health ./src                  # Code quality health
reveal health ssl://example.com      # SSL cert health
reveal health mysql://prod/db        # DB health
```
Consistent pass/warn/fail model with exit codes for CI/CD monitoring.

---

**`reveal dev`** ‚Äî developer tooling namespace
```bash
reveal dev new-adapter payments --uri pay
reveal dev new-rule R914 "deep nesting"
reveal dev inspect-config
```
Wraps the planned scaffold commands + config introspection into a coherent namespace.

#### Tier 2 (Post-v1.0)

```bash
reveal overview              # Auto-generated repo summary
reveal hotspots              # Complexity/quality issues (top N files/functions)
reveal onboarding            # First-day guide for unfamiliar codebases
reveal audit                 # Security/compliance focus (S, B, N rules)
reveal deps                  # Full dependency analysis (wraps imports://)
```

### Relationship Queries (Call Graphs)
```bash
reveal calls://src/api.py:handle_request  # Who calls this?
reveal depends://src/module/              # What depends on this?
```
**Why valuable**: Structure tells you what exists; relationships tell you what *matters*.

**Current limitation**: Requires cross-file static analysis. Tree-sitter infrastructure is ready, but call resolution is non-trivial.

### Git-Aware Defaults
```bash
reveal .                    # Defaults to changed files on branch
reveal --since HEAD~3       # Changes since commit
reveal --pr                 # PR context auto-detection
```
**Why valuable**: Makes tool instantly relevant to daily workflows.

---

### cPanel / SSL / nginx (session tropical-sleet-0227)

Real-world backlog from Sociamonials production cPanel work. All items driven by actual debugging sessions.

#### ssl:// improvements

| # | Feature | Description |
|---|---------|-------------|
| S1 | **Batch failure detail** | `--batch --check` shows pass/fail but not _why_. Make failure reason visible by default: `‚úó domain.com  EXPIRED 95 days ago (Nov 25, 2025)` / `‚úó domain.com  DNS FAILURE (NXDOMAIN)`. |
| S2 | **Cert file inspection** | `reveal ssl://file:///path/to/cert` ‚Äî inspect an on-disk cert without a live connection. cPanel stores certs at `/var/cpanel/ssl/apache_tls/DOMAIN/combined`. Enables disk-cert vs live-cert diff and expiry checks before nginx loads them. |
| S3 | **AutoSSL log awareness** | `reveal ssl://DOMAIN --check --diagnose` detects the Permission Denied / 404 pattern by cross-referencing the nginx error log for that domain alongside the cert check. Today's 404 is opaque without a manual log pivot. |
| S4 | **cPanel cert path resolution** | `reveal ssl://nginx:///etc/nginx/conf.d/users/preprodsociamoni.conf` resolves the cPanel cert path format (`/var/cpanel/ssl/apache_tls/DOMAIN/combined`) and shows on-disk cert expiry alongside the live check, flagging mismatches. |
| S5 | **Expiry in batch output** | `--expiring-within` is useful but the expiry date/delta should appear in batch output without a follow-up per-domain query. `‚ö† domain.com (expires in 12 days)` vs `‚úó domain.com (expired -95 days)`. |

#### nginx:// improvements

| # | Feature | Description |
|---|---------|-------------|
| N1 | **cPanel ACL awareness** | `--check-acl` flag checks that the `nobody` user has read access to all domain docroots referenced in location blocks. Directly catches the class of bug hit in the Feb 2026 incident. |
| N2 | **Include file location conflict detection** | Flag when two location blocks could match the same prefix (inline + included file). Example: `/.well-known/acme-challenge/` (inline, 26-char) vs `/.well-known/acme-challenge` (letsencrypt.conf, 25-char) ‚Äî nginx's longest-prefix-wins rule isn't obvious without parsing both. |
| N3 | **`--domain` filter for cPanel monoliths** | `reveal nginx:///etc/nginx/conf.d/users/USERNAME.conf --domain DOMAIN` extracts just the relevant server block from a 1,500-line cPanel user config (one server block per domain). |
| N4 | **ACME pipeline extraction** | `reveal nginx:///path/to/user.conf --extract acme-roots` ‚Üí per-domain table: `[domain] ‚Üí [nginx acme root path] ‚Üí [ACL status for nobody]`. Would have identified the Feb 2026 incident in one command. |

#### New adapter: cpanel://

cPanel has a WHM API and stable file conventions that reveal could wrap:

```bash
reveal cpanel://USERNAME/domains      # list addon domains + docroots
reveal cpanel://USERNAME/ssl          # cert status per domain (WHM API or on-disk)
reveal cpanel://USERNAME/acl-check    # nobody ACL health for all domain docroots
```

AutoSSL log parsing as a sub-adapter:

```bash
reveal autossl:///var/cpanel/logs/autossl/TIMESTAMP/
# ‚Üí per-domain outcomes table: domain / outcome / reason
```

#### Composed workflow: `--validate-nginx-acme`

A single flag that chains: extract domains from nginx config ‚Üí check live SSL status ‚Üí check ACME docroot permissions ‚Üí report combined findings.

```bash
reveal nginx:///etc/nginx/conf.d/users/USERNAME.conf --validate-nginx-acme
```

The "SSL audit for cPanel nginx" command that doesn't exist today. Could eventually become `reveal audit ssl://cpanel:USERNAME` under the subcommand model.

---

## Lower Priority / Speculative

| Feature | Notes |
|---------|-------|
| PostgreSQL adapter | mysql:// proves pattern; diminishing returns |
| Docker adapter | `docker inspect` already exists |
| LSP integration | Big effort; IDEs have good tools |
| --watch mode | Nice UX but not core; use `watch reveal file.py` |

---

## Explicitly Not Planned

These violate reveal's mission ("reveal reveals, doesn't modify") or have unclear value:

| Feature | Why Not |
|---------|---------|
| `--fix` auto-fix | Mission violation. Use Ruff/Black for formatting/fixes. |
| `semantic://` embedding search | Requires ML infrastructure; over-engineered |
| `trace://` execution traces | Wrong domain (debugging tools) |
| `live://` real-time monitoring | Wrong domain (observability tools) |
| Parquet/Arrow | Binary formats, not human-readable. Use pandas. |

---

## Language Support Status

**Current**: 31 built-in analyzers + 165+ via tree-sitter fallback

### Production-Ready
Python, JavaScript, TypeScript, Rust, Go, Java, C, C++, C#, Ruby, PHP, Kotlin, Swift, Dart, Zig, Scala, Lua, GDScript, Bash, SQL

### Config & Data
Nginx, Dockerfile, TOML, YAML, JSON, JSONL, Markdown, HTML, CSV, XML, INI, HCL/Terraform, GraphQL, Protobuf

### Office Formats
Excel (.xlsx), Word (.docx), PowerPoint (.pptx), LibreOffice (ODF)

### Tree-Sitter Fallback
165+ additional languages with basic structure extraction: Perl, R, Haskell, Elixir, OCaml, and more.

---

## Adapter Status

### Implemented (16)
| Adapter | Description |
|---------|-------------|
| `ast://` | Query code as database (complexity, size, type filters) |
| `claude://` | Claude conversation analysis |
| `diff://` | Compare files or git revisions |
| `domain://` | Domain registration, DNS records, health status |
| `env://` | Environment variable inspection |
| `git://` | Repository history, blame, commits |
| `help://` | Built-in documentation |
| `imports://` | Dependency analysis, circular detection |
| `json://` | JSON/JSONL deep inspection |
| `mysql://` | MySQL database schema inspection |
| `python://` | Python runtime inspection |
| `reveal://` | Reveal's own codebase |
| `sqlite://` | SQLite database inspection |
| `ssl://` | SSL/TLS certificate inspection |
| `stats://` | Codebase statistics |

### Planned
| Adapter | Notes |
|---------|-------|
| `nginx://` | Nginx config structured querying (Tier 3) |
| `calls://` | Call graph analysis (post-v1.0) |

---

## Contributing

See [CONTRIBUTING.md](CONTRIBUTING.md) for how to add analyzers, adapters, or rules.

**Good first contributions:**
- Language analyzer improvements
- Pattern detection rules
- Documentation and examples
