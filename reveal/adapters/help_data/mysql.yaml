# MySQL Adapter Help Data
# Extracted from mysql/adapter.py::get_help() to reduce function complexity

name: mysql
description: 'MySQL database inspection - progressive disclosure of health, connections, InnoDB, replication'
syntax: 'mysql://[user:password@]host[:port][/element]'

examples:
  - uri: 'mysql://'
    description: 'Auto-connect using ~/.my.cnf credentials (simplest, recommended)'
  - uri: 'mysql://localhost'
    description: 'Health overview (connections, InnoDB, replication, storage)'
  - uri: 'mysql://localhost/connections'
    description: 'Detailed connection info and processlist'
  - uri: 'mysql://localhost/innodb'
    description: 'InnoDB buffer pool, locks, pending I/O'
  - uri: 'mysql://localhost/replication'
    description: 'Replication status and lag'
  - uri: 'mysql://localhost/storage'
    description: 'Storage usage by database'
  - uri: 'mysql://localhost --check'
    description: 'Run health checks with thresholds'
  - uri: 'mysql://localhost --check --only-failures'
    description: 'Show only problems (hide passed checks)'
  - uri: 'mysql:///innodb'
    description: 'Use ~/.my.cnf credentials, specify element only'

elements:
  connections: 'Connection details and processlist'
  performance: 'Query performance metrics'
  innodb: 'InnoDB engine status'
  replication: 'Replication status and lag'
  storage: 'Storage usage by database'
  storage/<db>: 'Specific database tables'
  errors: 'Error indicators'
  variables: 'Server configuration'
  health: 'Comprehensive health check'
  databases: 'Database list'
  indexes: 'Index usage statistics with reset detection'

flags:
  --check: 'Run health checks with pass/warn/fail thresholds'
  --advanced: 'Run advanced checks with --check (reserved for future enhanced checks) [Universal flag]'
  --only-failures: 'Hide passed checks, show only warnings and failures [Universal flag]'
  --batch: 'Batch mode with aggregated results (works with --stdin) [Universal flag]'

features:
  - 'DBA health snapshot (~100 tokens vs 5000+ for raw SQL)'
  - 'Progressive disclosure (structure → element → detail)'
  - 'Industry-standard tuning ratios (table scans, thread cache, temp tables, etc.)'
  - 'Time context accuracy (uses MySQL clock, not local machine)'
  - 'Snapshot timestamps on ALL endpoints (snapshot_time, server_start_time, uptime_seconds, measurement_window)'
  - 'Index usage analysis (most used, unused) with performance_schema reset detection'
  - 'Automatic detection of performance_schema counter resets (removes metric ambiguity)'
  - 'Definitive measurement basis for index metrics (since_server_start or since_reset)'
  - 'Health checks with pass/warn/fail thresholds'
  - 'Credential resolution (env vars, ~/.my.cnf)'
  - 'Token-efficient for AI agent consumption'

try_now:
  - "reveal mysql://localhost"
  - "reveal mysql://localhost/connections"
  - "reveal mysql://localhost --check"

workflows:
  - name: 'Quick Health Check'
    scenario: 'Need to quickly assess database health'
    steps:
      - "reveal mysql://localhost              # Overview"
      - "reveal mysql://localhost --check      # Health checks"
      - "reveal mysql://localhost/replication  # If issues found"
  - name: 'Debug Slow Performance'
    scenario: 'Database is slow, need to find bottleneck'
    steps:
      - "reveal mysql://localhost/performance  # Check slow queries"
      - "reveal mysql://localhost/innodb       # Buffer pool hit rate"
      - "reveal mysql://localhost/connections  # Check for blocking"
  - name: 'Production Database Monitoring (Remote)'
    scenario: 'Monitor production database via ~/.my.cnf'
    steps:
      - "# Configure ~/.my.cnf with [client] credentials"
      - "reveal mysql://                       # Auto-connect, health overview"
      - "reveal mysql:// --check               # Automated health checks"
      - "reveal mysql:///storage               # Storage usage trends"
  - name: 'Track Storage Growth Over Time'
    scenario: 'Monitor database growth trends with accurate timestamps'
    steps:
      - "reveal mysql://localhost/storage --format=json | jq '.snapshot_time, .databases[0].size_gb'"
      - "# Compare snapshots at different times using snapshot_time field"
      - "# All endpoints include snapshot_time for accurate time-series analysis"
  - name: 'Index Usage Analysis with Reset Detection'
    scenario: 'Find unused indexes with confidence about data freshness'
    steps:
      - "reveal mysql://localhost/indexes"
      - "# Check performance_schema_status.counters_reset_detected field"
      - "# If false: metrics since server start (measurement_start_time shows when)"
      - "# If true: metrics since performance_schema reset (measurement_start_time shows reset time)"
      - "# measurement_basis field clarifies: 'since_server_start' or 'since_reset'"

anti_patterns:
  - bad: "mysql -e 'SHOW STATUS' | grep -i innodb"
    good: "reveal mysql://localhost/innodb"
    why: "50x fewer tokens, structured output, DBA-relevant signals only"
  - bad: "mysql -e 'SHOW PROCESSLIST\\G'"
    good: "reveal mysql://localhost/connections"
    why: "Categorized by state, highlights long-running queries"

notes:
  - '⚠️  IMPORTANT: Requires pymysql dependency'
  - 'Install: pip install reveal-cli[database] OR pip install pymysql'
  - 'Credentials: URI > env vars > ~/.my.cnf (3-tier resolution system)'
  - 'Env vars: MYSQL_HOST, MYSQL_PORT, MYSQL_USER, MYSQL_PASSWORD, MYSQL_DATABASE'
  - '~/.my.cnf: Reads [client] section when params not explicitly set (RECOMMENDED for production)'
  - 'Production validated: Tested against 189GB Digital Ocean MySQL 8.0.35 with SSL/TLS'
  - 'Health thresholds: connections <80%, buffer pool >99%, replication lag <60s'
  - 'DBA tuning ratios: table scans <25%, thread cache miss <10%, temp tables on disk <25%'
  - 'Timing context: All endpoints include snapshot_time (when collected), server_start_time (when server booted), uptime_seconds (server uptime), measurement_window (human-readable uptime)'
  - 'Timestamp accuracy: Uses MySQL UNIX_TIMESTAMP() to avoid timezone/drift issues with remote connections'
  - 'Index metrics: /indexes endpoint detects performance_schema counter resets automatically (>1 hour gap between server uptime and oldest event)'
  - 'Reset detection: If counters were reset (TRUNCATE TABLE performance_schema.*), measurement_basis = "since_reset" with reset timestamp'
  - 'No reset: measurement_basis = "since_server_start" with server start timestamp'
  - 'Simple usage: Just run "reveal mysql://" if ~/.my.cnf is configured'

output_formats:
  - text
  - json
  - grep

see_also:
  - 'reveal help://env - Environment variables'
  - 'reveal help://python - Python runtime inspection'
